<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Wallet Connect (All Browser Support)</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 80px; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
    #status { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>ü™ô Universal Wallet Connect</h1>
  <button id="connectWallet">Connect Wallet</button>
  <p id="status">Status: Not connected</p>

  <!-- ‚úÖ Load ethers.js (CDN 1: Cloudflare) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.13.2/ethers.umd.min.js"></script>

  <!-- ‚úÖ CDN 2 Fallback (jsDelivr) -->
  <script>
    window.addEventListener('error', function (e) {
      if (e.target.tagName === 'SCRIPT' && e.target.src.includes('ethers')) {
        console.warn('‚ö†Ô∏è Cloudflare failed ‚Äî trying jsDelivr fallback...');
        const script = document.createElement('script');
        script.src = "https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.umd.min.js";
        document.head.appendChild(script);
      }
    });
  </script>

  <!-- ‚úÖ Verification before running wallet code -->
  <script>
    async function loadEthers() {
      for (let i = 0; i < 20; i++) {
        if (window.ethers) return true;
        await new Promise(r => setTimeout(r, 300));
      }
      return false;
    }

    async function startApp() {
      const ready = await loadEthers();
      const status = document.getElementById("status");
      if (!ready) {
        status.textContent = "‚ùå Ethers.js still not available. Check your internet or script blocker.";
        console.error("Ethers.js not loaded after fallback.");
        return;
      }

      const btn = document.getElementById("connectWallet");
      btn.addEventListener("click", async () => {
        try {
          if (!window.ethereum) {
            alert("No wallet found! Install MetaMask or compatible wallet.");
            return;
          }

          let ethereum = window.ethereum;
          if (Array.isArray(window.ethereum.providers)) {
            const mm = window.ethereum.providers.find(p => p.isMetaMask);
            if (mm) ethereum = mm;
          }

          const provider = new ethers.BrowserProvider(ethereum);
          await ethereum.request({ method: "eth_requestAccounts" });
          const signer = await provider.getSigner();
          const address = await signer.getAddress();
          const network = await provider.getNetwork();

          console.log("Connected:", address, "on", network.name);
          status.textContent = `‚úÖ Connected: ${address.slice(0,6)}...${address.slice(-4)} (${network.name})`;
        } catch (err) {
          console.error("Wallet connect error:", err);
          status.textContent = "‚ùå " + (err.message || "Connection failed");
        }
      });
    }

    startApp();
  </script>
</body>
</html>
